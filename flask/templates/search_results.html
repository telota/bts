<!DOCTYPE html>
<html>
    <head>
	<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='style.css')}}">
<style type="text/css">
.container {
    display: grid;
    grid-template-rows: 3em 3em auto;
    grid-template-columns: 20em 60em auto;
    grid-template-areas:
        "logo searchbar  searchbar"
		"logo searchtabs searchtabs"
        ".    main       .";
}

#search_form > input {
	display: inline-block;
}

.logo-container {
	grid-area: logo;
	background-color: #fafafa;
	width: 100%;
	text-align: right;
	border-bottom: 1px solid #eee;
}

.searchbar {
    grid-area: searchbar;
	background-color: #fafafa;
}

#searchtabs {
    grid-area: searchtabs;
	background-color: #f8f8f8;
	border-bottom: 1px solid #eee;
	display: none;
	flex-wrap: nowrap;
	align-items: stretch;
}

a.searchtab {
	margin: 1em 0 0 0;
    padding: 0.2em 0.5em 0.5em 0.5em;
	font-size: 10pt;
	color: #555;
	border-bottom: 3pt solid transparent;
	align-self: flex-end;
}

a.searchtab.active {
	border-bottom: 3pt solid #00a;
}

.results {
    grid-area: main;
}

a.resulttype:hover {
    background: #b65403;
    color: white;
}

div.result-name {
	color: #00a;
	margin-bottom: 0.2em;
    font-weight: bold;
    font-size: 12pt;
}

div.result-path {
	color: #0a0;
}

div.result-preview {
	color: #888;
}

div.result-snippet {
}

a.single-result-entry {
    display: block;
    color: #333;
    text-decoration: none;
    margin-top: 2em;
    padding-bottom: 2em;
    border-bottom: 1px solid #aaa;
	font-size: 10pt;
}

div.query-stats {
    color: #aaa;
	font-size: 10pt;
    font-weight: bold;
}


.tab-resultcount {
	color: #aaa;
	font-size: 10pt;
	vertical-align: middle;
}

.results-pane {
	display: flex;
	flex-direction: column;
}

.resultcount {
	color: #aaa;
	font-size: 10pt;
	padding-top: 0.5em;
}

#submit_button {
	background-color: white;
	color: #00a;
}

.pagelinks > a {
	text-decoration: none;
}

.pagelinks > a:visited {
	text-decoration: none;
}

.single-pagelink, .current-pagelink {
	display: inline-block;
	width: 1.5em;
	text-align: center;
}

.current-pagelink {
	border-bottom: 3pt solid #00a;
}

.pagelinks {
	align-self: center;
	margin: 1em 0 1em 0;
	font-size: 16pt;
}
</style>
</head>
<body>
<div class="container">
	<div class="logo-container">
		<div class="logo-small">
			<div class="c-blue">Ã„</div><div class="c-green">g</div><div class="c-red">y</div><div class="c-yellow">y</div><div class="c-blue">g</div><div class="c-green">l</div><div class="c-red">e</div>
		</div>
	</div>
    <div class="searchbar">
		<form id="search_form">
			<input type=text id="search_input" autofocus value="{{query}}">
			<input type=submit id="submit_button" value="Search">
		</form>
    </div>
    <div id="searchtabs">
	{% for type, desc in SEARCH_TYPE_DESCRIPTIONS.items() %}
		<a class="searchtab" id="searchtab-{{type}}" data-searchtype="{{ type }}">
			<span class="label">{{ desc }}</span> <span class="tab-resultcount">{{ result_counts[type] }}<span>
		</a>
	{% endfor %}
    </div>
    <div class="results">
	{% for type, results in matches.items() %}
	<div class="results-pane" id="results-pane-{{ type }}">
		<div class="resultcount">Showing {{ offset }}-{{ offset+limit }} of {{ result_counts[type] }} results</div>
	    <div class="result-entries">
		{% for result in results %}
		<a class="single-result-entry result-type-{{ ObjectType(result.type or 0).name.lower() }}" href="{{url_for('render_corpus_object', oid=result.id)}}">
		    <div class="result-name">{{ result.name }}</div>
		    <div class="result-path">{{ result.path }}</div>
		    <div class="result-preview">{{ result.preview }} ...</div>
		    <div class="result-snippet">{{ format_snippet(result.snippet) | safe }}</div>
		</a>
		{% endfor %}
	    </div>
		<div class="pagelinks">
			{% if offset > 0 %}
				<a class="single-pagelink pagelink-prev" href="{{url_for('search_results', query=query, limit=limit, offset=max(0, offset-limit))}}">&#x25C0;</a>
			{% endif %}
			{% for page in range(max(0, offset//limit-npagelinks), min(offset//limit+npagelinks, -(-result_counts[type]//limit))) %}
				{% if page != offset//limit %}
					<a class="single-pagelink" href="{{url_for('search_results', query=query, limit=limit, offset=page*limit)}}">{{ page+1 }}</a>
				{% else %}
					<span class="current-pagelink">{{ page+1 }}</span>
				{% endif %}
			{% endfor %}
			{% if offset+limit < result_counts[type] %}
				<a class="single-pagelink pagelink-next" href="{{url_for('search_results', query=query, limit=limit, offset=offset+limit)}}">&#x25B6;</a>
		   {% endif %}
		</div>
	</div>
	{% endfor %}
	<div class="query-stats">Query times:
	{% for k, v in query_times.items() %}
	    {{ k }}={{ '%.3f' | format(v*1000) }}ms
	{% endfor %}
	</div>
    </div>
</div>
</body>
<script type="text/javascript">
function redirectSearch(event) {
    event.preventDefault();
    var search_term = document.querySelector("#search_input").value;
    window.open("/search?query="+encodeURI(search_term), "_top");
}
document.querySelector("#search_form").onsubmit = redirectSearch;

function showResultPane(searchtype) {
    document.querySelector("#searchtabs").style.display = "flex";
    for (var pane of document.querySelectorAll(".results-pane"))
        pane.style.display = "none";
    document.querySelector("#results-pane-"+searchtype).style.display = "flex";
	for (var tab of document.querySelectorAll(".searchtab"))
		tab.classList.remove("active");
	document.querySelector("#searchtab-"+searchtype).classList.add("active");
}

function toggleSearchtype(event) {
    var searchtype = event.currentTarget.attributes["data-searchtype"].value;
    console.log('Switching to', searchtype);
    showResultPane(searchtype)
}

for (var elem of document.querySelectorAll("#searchtabs > a")) {
    elem.onclick = toggleSearchtype
}

showResultPane("{{ default_searchtype }}");
</script> 
</html>
